graph TD
    %% Header
    %% Mantra RWA Compliance - Comprehensive Contact Flow
    
    %% Actors
    User([User / Investor])
    Admin([Protocol Admin])
    Agent([Fund/Bond Agent])
    Validators([Interop Validators])
    
    %% Core Infrastructure
    subgraph Core [Core Logic & Compliance]
        Factory[Factory Contract]
        CustomMarker[Custom Marker Contract]
        Verifier[Verifier Contract]
        NativeMarker[Provenance Native Marker]
    end
    
    %% Regulatory & External
    subgraph External [External / Infra]
        Oracle[Price Feed Oracle]
        Multisig[Interop Multisig]
        BandChain[Band Protocol]
    end
    
    %% Products
    subgraph Products [RWA Investment Products]
        Fund[Fund Contract]
        Bond[Treasury Bond Contract]
    end
    
    %% Bridge Interop
    subgraph Bridge [Cross-Chain Bridge]
        InteropCore[Interop Core Contract]
    end
    
    %% --- RELATIONS ---
    
    %% 1. Onboarding & Identity
    User -- 1. Submit ZK Proof --> Verifier
    Verifier -- 2. Auth Mint --> CustomMarker
    
    %% 2. Orchestration
    Admin -- 3. Deploy/Config --> Factory
    Factory -- 4. Instantiate --> CustomMarker
    
    %% 3. Compliance Enforced Transfer
    User -- 5. Send Request --> CustomMarker
    CustomMarker -- 6. Check Whitelist/Freeze --> CustomMarker
    CustomMarker -- 7. Execute Transfer --> NativeMarker
    
    %% 4. Fund Interaction
    Agent -- 8. Manage Config --> Fund
    Fund -- 9. Mint/Burn Shares --> CustomMarker
    Fund -- 10. Get NAV Rate --> Oracle
    Oracle -.-> BandChain
    
    %% 5. Bond Interaction
    Agent -- 11. Share Stablecoin (Coupon) --> Bond
    Bond -- 12. Payout (Bank Send) --> User
    
    %% 6. Cross-Chain Flow
    Validators -- 13. Vote (Witness Event) --> Multisig
    Multisig -- 14. Execute (Threshold Met) --> InteropCore
    InteropCore -- 15. Mint/Burn (Bridge) --> CustomMarker
    
    %% Styles
    classDef core fill:#ff9999,stroke:#333,stroke-width:2px;
    classDef product fill:#99ff99,stroke:#333,stroke-width:2px;
    classDef infra fill:#9999ff,stroke:#333,stroke-width:2px;
    classDef actor fill:#ffffff,stroke:#333,stroke-dasharray: 5 5;
    
    class Factory,CustomMarker,Verifier,NativeMarker core;
    class Fund,Bond product;
    class Oracle,Multisig,InteropCore,BandChain infra;
    class User,Admin,Agent,Validators actor;
